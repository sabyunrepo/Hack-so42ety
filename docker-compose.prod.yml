services:
  backend:
    environment:
      - APP_ENV=prod
      - DEBUG=false
    volumes:
      # Remove source code mount for production (rely on image)
      # Only mount data and backup
      - app-data:/app/data

  nginx:
    build:
      context: .
      dockerfile: docker/nginx/Dockerfile
      args:
        APP_ENV: prod
    image: moriai-nginx:prod
    volumes:
      - app-data:/app/data:ro
      # Mount frontend build output
      - frontend-dist:/usr/share/nginx/html:ro

  cloudflared:
    profiles:
      - production
